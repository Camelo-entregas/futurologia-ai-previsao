
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Futurologia AI</title>
</head>
<body>
  <h1>Futurologia AI</h1>
  <div>
    <label for="league-select">Campeonato</label>
    <select id="league-select">
      <option value="">Selecione</option>
      <option value="71">BR - Brasileir√£o S√©rie A</option>
      <option value="135">IT - Serie A</option>
      <option value="39">ING - Premier League</option>
    </select>
  </div>

  <div>
    <label for="home-team">Time Mandante</label>
    <select id="home-team" disabled>
      <option value="">Selecione o campeonato</option>
    </select>
  </div>

  <div>
    <label for="away-team">Time Visitante</label>
    <select id="away-team" disabled>
      <option value="">Selecione o campeonato</option>
    </select>
  </div>

  <button id="analyze-btn" disabled>‚öΩ Analisar Confronto</button>

  <div id="result"></div>

  <script>
    const API_KEY = '62271872bf054aeb61b121932c95d3ee';
    const API_BASE_URL = 'https://v3.football.api-sports.io/';
    const SEASON = 2024;

    const headers = { 'x-apisports-key': API_KEY };

    const leagueSelect = document.getElementById('league-select');
    const homeTeamSelect = document.getElementById('home-team');
    const awayTeamSelect = document.getElementById('away-team');
    const analyzeBtn = document.getElementById('analyze-btn');
    const resultDiv = document.getElementById('result');

    const teamsCache = {};

    leagueSelect.addEventListener('change', async function () {
      const leagueId = this.value;
      if (!leagueId) return resetTimes();

      homeTeamSelect.disabled = true;
      awayTeamSelect.disabled = true;
      homeTeamSelect.innerHTML = '<option>Carregando...</option>';
      awayTeamSelect.innerHTML = '<option>Carregando...</option>';

      try {
        if (!teamsCache[leagueId]) {
          const res = await fetch(`${API_BASE_URL}teams?league=${leagueId}&season=${SEASON}`, { headers });
          const data = await res.json();
          teamsCache[leagueId] = data.response;
        }

        const teams = teamsCache[leagueId];
        homeTeamSelect.innerHTML = '<option value="">Selecione o mandante</option>';
        awayTeamSelect.innerHTML = '<option value="">Selecione o visitante</option>';

        teams.forEach(teamObj => {
          const team = teamObj.team;
          const opt1 = new Option(team.name, team.id);
          const opt2 = new Option(team.name, team.id);
          homeTeamSelect.add(opt1);
          awayTeamSelect.add(opt2);
        });

        homeTeamSelect.disabled = false;
        awayTeamSelect.disabled = false;
      } catch (err) {
        console.error(err);
        resetTimes();
      }
    });

    function resetTimes() {
      homeTeamSelect.innerHTML = '<option>Selecione o campeonato</option>';
      awayTeamSelect.innerHTML = '<option>Selecione o campeonato</option>';
      homeTeamSelect.disabled = true;
      awayTeamSelect.disabled = true;
      analyzeBtn.disabled = true;
    }

    homeTeamSelect.addEventListener('change', toggleButton);
    awayTeamSelect.addEventListener('change', toggleButton);

    function toggleButton() {
      const home = homeTeamSelect.value;
      const away = awayTeamSelect.value;
      analyzeBtn.disabled = !(home && away && home !== away);
    }

    analyzeBtn.addEventListener('click', async () => {
      const league = leagueSelect.value;
      const homeId = homeTeamSelect.value;
      const awayId = awayTeamSelect.value;

      resultDiv.innerHTML = "üîé Buscando dados...";

      try {
        const [homeStats, awayStats, standingsData] = await Promise.all([
          fetch(`${API_BASE_URL}teams/statistics?team=${homeId}&league=${league}&season=${SEASON}`, { headers }).then(r => r.json()),
          fetch(`${API_BASE_URL}teams/statistics?team=${awayId}&league=${league}&season=${SEASON}`, { headers }).then(r => r.json()),
          fetch(`${API_BASE_URL}standings?league=${league}&season=${SEASON}`, { headers }).then(r => r.json())
        ]);

        const standings = standingsData.response[0].league.standings[0];
        const homeStanding = standings.find(t => t.team.id == homeId);
        const awayStanding = standings.find(t => t.team.id == awayId);

        const resumo = `
          <h3>üèÜ An√°lise do Confronto</h3>
          <p><strong>${homeStats.response.team.name}</strong></p>
          <ul>
            <li>Posi√ß√£o na tabela: ${homeStanding.rank}</li>
            <li>Vit√≥rias: ${homeStats.response.fixtures.wins.total}</li>
            <li>Gols Marcados: ${homeStats.response.goals.for.total.total}</li>
          </ul>

          <p><strong>${awayStats.response.team.name}</strong></p>
          <ul>
            <li>Posi√ß√£o na tabela: ${awayStanding.rank}</li>
            <li>Vit√≥rias: ${awayStats.response.fixtures.wins.total}</li>
            <li>Gols Marcados: ${awayStats.response.goals.for.total.total}</li>
          </ul>
        `;

        resultDiv.innerHTML = resumo;
      } catch (err) {
        resultDiv.innerHTML = "‚ùå Erro ao buscar dados.";
        console.error(err);
      }
    });
  </script>
</body>
</html>
