<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- ... (mantenha todo o head igual) ... -->
</head>
<body>
  <!-- ... (mantenha todo o HTML igual) ... -->

  <script>
    // Configuração da API Football Data
    const API_KEY = '62271872bf054aeb61b121932c95d3ee'; // SUA CHAVE JÁ INSERIDA
    const API_BASE_URL = 'https://api.football-data.org/v4/';
    
    document.addEventListener('DOMContentLoaded', function() {
      const leagueSelect = document.getElementById('league-select');
      const homeTeamSelect = document.getElementById('home-team');
      const awayTeamSelect = document.getElementById('away-team');
      const analyzeBtn = document.getElementById('analyze-btn');
      const loadingDiv = document.getElementById('loading');
      const analysisContainer = document.getElementById('analysis-container');
      const errorMessage = document.getElementById('error-message');
      
      // Cache para armazenar dados já buscados
      const teamsCache = {};
      const matchesCache = {};
      
      // Carregar times quando selecionar campeonato
      leagueSelect.addEventListener('change', function() {
        const leagueId = this.value;
        
        if (!leagueId) {
          resetTeamSelects();
          return;
        }
        
        // Verificar se já temos os times em cache
        if (teamsCache[leagueId]) {
          populateTeamSelects(teamsCache[leagueId]);
          return;
        }
        
        // Mostrar loading
        prepareTeamSelectsForLoading();
        
        // Buscar times da API
        fetchTeams(leagueId);
      });
      
      function resetTeamSelects() {
        homeTeamSelect.innerHTML = '<option value="">Selecione um campeonato</option>';
        awayTeamSelect.innerHTML = '<option value="">Selecione um campeonato</option>';
        homeTeamSelect.disabled = true;
        awayTeamSelect.disabled = true;
        analyzeBtn.disabled = true;
      }
      
      function prepareTeamSelectsForLoading() {
        homeTeamSelect.disabled = true;
        awayTeamSelect.disabled = true;
        homeTeamSelect.innerHTML = '<option value="">Carregando times...</option>';
        awayTeamSelect.innerHTML = '<option value="">Carregando times...</option>';
      }
      
      function fetchTeams(leagueId) {
        fetch(`${API_BASE_URL}competitions/${leagueId}/teams`, {
          headers: {
            'X-Auth-Token': API_KEY
          }
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Erro ao carregar times');
          }
          return response.json();
        })
        .then(data => {
          if (!data.teams || data.teams.length === 0) {
            throw new Error('Nenhum time encontrado para este campeonato');
          }
          
          // Armazenar no cache
          teamsCache[leagueId] = data.teams;
          populateTeamSelects(data.teams);
        })
        .catch(error => {
          console.error('Erro:', error);
          showError('Erro ao carregar times. Tente novamente mais tarde.');
          homeTeamSelect.innerHTML = '<option value="">Erro ao carregar</option>';
          awayTeamSelect.innerHTML = '<option value="">Erro ao carregar</option>';
        });
      }
      
      function populateTeamSelects(teams) {
        // Ordenar times alfabeticamente
        teams.sort((a, b) => a.name.localeCompare(b.name));
        
        homeTeamSelect.innerHTML = '<option value="">Selecione o mandante</option>';
        awayTeamSelect.innerHTML = '<option value="">Selecione o visitante</option>';
        
        teams.forEach(team => {
          const option = `<option value="${team.id}">${team.name}</option>`;
          homeTeamSelect.innerHTML += option;
          awayTeamSelect.innerHTML += option;
        });
        
        homeTeamSelect.disabled = false;
        awayTeamSelect.disabled = false;
      }
      
      // Habilitar botão de análise quando ambos times forem selecionados
      homeTeamSelect.addEventListener('change', checkTeamsSelected);
      awayTeamSelect.addEventListener('change', checkTeamsSelected);
      
      function checkTeamsSelected() {
        const homeSelected = homeTeamSelect.value && homeTeamSelect.value !== '';
        const awaySelected = awayTeamSelect.value && awayTeamSelect.value !== '';
        const differentTeams = homeTeamSelect.value !== awayTeamSelect.value;
        
        analyzeBtn.disabled = !(homeSelected && awaySelected && differentTeams);
        
        if (!differentTeams && homeSelected && awaySelected) {
          showError('Selecione times diferentes para análise');
        } else {
          hideError();
        }
      }
      
      // ... (mantenha o restante do código JavaScript igual) ...
      
      // Botão de análise
      analyzeBtn.addEventListener('click', function() {
        const leagueId = leagueSelect.value;
        const homeTeamId = homeTeamSelect.value;
        const awayTeamId = awayTeamSelect.value;
        
        if (!leagueId || !homeTeamId || !awayTeamId) {
          showError('Selecione um campeonato e ambos os times!');
          return;
        }
        
        if (homeTeamId === awayTeamId) {
          showError('Selecione times diferentes para análise');
          return;
        }
        
        // Mostrar loading
        loadingDiv.style.display = 'block';
        analysisContainer.style.display = 'none';
        hideError();
        
        // Buscar dados dos times
        const leagueTeams = teamsCache[leagueId];
        const homeTeam = leagueTeams.find(t => t.id == homeTeamId);
        const awayTeam = leagueTeams.find(t => t.id == awayTeamId);
        
        // Buscar histórico de confrontos
        fetchHeadToHead(homeTeamId, awayTeamId, homeTeam, awayTeam);
      });

      // ... (mantenha todas as outras funções existentes) ...
    });
  </script>
</body>
</html>