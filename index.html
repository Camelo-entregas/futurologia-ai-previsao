<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- ... (mantenha todo o head igual) ... -->
</head>
<body>
  <!-- ... (mantenha o HTML igual até o script) ... -->

  <script>
    // Configuração da API
    const API_KEY = '62271872bf054aeb61b121932c95d3ee';
    const API_BASE_URL = 'https://api.football-data.org/v4/';
    
    document.addEventListener('DOMContentLoaded', function() {
      // Elementos DOM
      const leagueSelect = document.getElementById('league-select');
      const homeTeamSelect = document.getElementById('home-team');
      const awayTeamSelect = document.getElementById('away-team');
      const analyzeBtn = document.getElementById('analyze-btn');
      const loadingDiv = document.getElementById('loading');
      const analysisContainer = document.getElementById('analysis-container');
      const errorMessage = document.getElementById('error-message');
      
      // Cache
      const teamsCache = {};
      
      // Event Listeners
      leagueSelect.addEventListener('change', loadTeams);
      homeTeamSelect.addEventListener('change', validateForm);
      awayTeamSelect.addEventListener('change', validateForm);
      analyzeBtn.addEventListener('click', analyzeMatch);
      
      // Função principal para carregar times
      async function loadTeams() {
        const leagueId = leagueSelect.value;
        
        if (!leagueId) {
          resetTeamSelects();
          return;
        }
        
        try {
          // Preparar interface
          prepareTeamSelectsForLoading();
          hideError();
          
          // Verificar cache
          if (teamsCache[leagueId]) {
            populateTeamSelects(teamsCache[leagueId]);
            return;
          }
          
          // Buscar times da API com tratamento de erro melhorado
          const response = await fetch(`${API_BASE_URL}competitions/${leagueId}/teams`, {
            headers: { 'X-Auth-Token': API_KEY }
          });
          
          // Verificar se a resposta é válida
          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.message || 'Erro na API');
          }
          
          const data = await response.json();
          
          // Verificar se existem times
          if (!data.teams || data.teams.length === 0) {
            throw new Error('Nenhum time disponível para este campeonato');
          }
          
          // Armazenar no cache e popular selects
          teamsCache[leagueId] = data.teams;
          populateTeamSelects(data.teams);
          
        } catch (error) {
          console.error('Erro ao carregar times:', error);
          showError(error.message || 'Falha ao carregar times. Tente outro campeonato.');
          resetTeamSelects();
        }
      }
      
      function populateTeamSelects(teams) {
        // Ordenar times e popular selects
        const sortedTeams = [...teams].sort((a, b) => a.name.localeCompare(b.name));
        
        homeTeamSelect.innerHTML = '<option value="">Selecione o mandante</option>';
        awayTeamSelect.innerHTML = '<option value="">Selecione o visitante</option>';
        
        sortedTeams.forEach(team => {
          const option = `<option value="${team.id}">${team.name}</option>`;
          homeTeamSelect.innerHTML += option;
          awayTeamSelect.innerHTML += option;
        });
        
        homeTeamSelect.disabled = false;
        awayTeamSelect.disabled = false;
      }
      
      function validateForm() {
        const homeSelected = homeTeamSelect.value && homeTeamSelect.value !== '';
        const awaySelected = awayTeamSelect.value && awayTeamSelect.value !== '';
        const differentTeams = homeTeamSelect.value !== awayTeamSelect.value;
        
        analyzeBtn.disabled = !(homeSelected && awaySelected && differentTeams);
        
        if (homeSelected && awaySelected && !differentTeams) {
          showError('Selecione times diferentes');
        } else {
          hideError();
        }
      }
      
      // ... (mantenha as outras funções como analyzeMatch, fetchHeadToHead, etc) ...
      
      function prepareTeamSelectsForLoading() {
        homeTeamSelect.disabled = true;
        awayTeamSelect.disabled = true;
        homeTeamSelect.innerHTML = '<option value="">Carregando times...</option>';
        awayTeamSelect.innerHTML = '<option value="">Carregando times...</option>';
      }
      
      function resetTeamSelects() {
        homeTeamSelect.innerHTML = '<option value="">Selecione um campeonato</option>';
        awayTeamSelect.innerHTML = '<option value="">Selecione um campeonato</option>';
        homeTeamSelect.disabled = true;
        awayTeamSelect.disabled = true;
        analyzeBtn.disabled = true;
      }
      
      function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = 'block';
      }
      
      function hideError() {
        errorMessage.style.display = 'none';
      }
    });
  </script>
</body>
</html>